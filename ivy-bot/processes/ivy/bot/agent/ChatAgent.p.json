{
  "$schema" : "https://json-schema.axonivy.com/process/13.2.0/process.json",
  "id" : "19C4F999088CFA12",
  "kind" : "CALLABLE_SUB",
  "config" : {
    "data" : "ivy.bot.agent.ChatAgentData"
  },
  "elements" : [ {
      "id" : "f0",
      "type" : "CallSubStart",
      "name" : "chat(String)",
      "config" : {
        "signature" : "chat",
        "input" : {
          "params" : [
            { "name" : "query", "type" : "String", "desc" : "The user message to send to the AI agent" }
          ],
          "map" : {
            "out.query" : "param.query"
          }
        },
        "result" : {
          "params" : [
            { "name" : "answer", "type" : "entity.Message", "desc" : "The AI agent response" }
          ],
          "map" : {
            "result.answer" : "in.answer"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 208 }
      },
      "connect" : [
        { "id" : "f6", "to" : "f5" }
      ]
    }, {
      "id" : "f1",
      "type" : "CallSubEnd",
      "visual" : {
        "at" : { "x" : 528, "y" : 208 }
      }
    }, {
      "id" : "f5",
      "type" : "ProgramInterface",
      "name" : "AI Agent",
      "config" : {
        "javaClass" : "com.axonivy.utils.smart.workflow.AgenticProcessCall",
        "userConfig" : {
          "system" : "Axon Ivy AI Assistant - helps employees with questions and provides information about company policies. Available tools: (1) retrievePolicies - call this when users ask about company policies including benefits (health insurance, dental, vision, 401k, life insurance, disability, wellness programs), leave policies (vacation, sick leave, FMLA, parental leave, bereavement), or general HR policies (code of conduct, dress code, work hours, attendance, workplace safety, confidentiality). Use the returned policy content to provide accurate, helpful answers with specific policy details. (2) casualAnswer - call this when the user's message is informal, casual, or not related to company policies, such as greetings, jokes, or off-topic questions. Use the returned message to respond politely.",
          "tools" : "[\"retrievePolicies\",\"casualAnswer\"]",
          "resultType" : "entity.Message.class",
          "resultMapping" : "in.answer",
          "query" : "<%= in.query %>"
        }
      },
      "visual" : {
        "at" : { "x" : 304, "y" : 208 }
      },
      "connect" : [
        { "id" : "f7", "to" : "f1" }
      ]
    }, {
      "id" : "f8",
      "type" : "CallSubStart",
      "name" : "retrievePolicies(String)",
      "config" : {
        "signature" : "retrievePolicies",
        "input" : {
          "params" : [
            { "name" : "query", "type" : "String", "desc" : "The HR policy question or query from the user" }
          ],
          "map" : {
            "out.query" : "param.query"
          }
        },
        "result" : {
          "params" : [
            { "name" : "retrievedPolicies", "type" : "String", "desc" : "Formatted HR policy content relevant to the query" }
          ],
          "map" : {
            "result.retrievedPolicies" : "in.retrievedPolicies"
          }
        }
      },
      "tags" : [
        "tool"
      ],
      "visual" : {
        "at" : { "x" : 96, "y" : 400 },
        "description" : "Use this tool when the user is asking about company policies, including benefits, leave, HR rules, dress code, work hours, code of conduct, or any workplace-related policy questions"
      },
      "connect" : [
        { "id" : "f11", "to" : "f9" }
      ]
    }, {
      "id" : "f9",
      "type" : "SubProcessCall",
      "name" : "Call PolicyRetriever",
      "config" : {
        "processCall" : "hr/knowledge/base/PolicyRetriever:retrievePolicies(String)",
        "call" : {
          "map" : {
            "param.query" : "in.query"
          }
        },
        "output" : {
          "map" : {
            "out" : "in",
            "out.retrievedPolicies" : "result.formattedPolicies"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 304, "y" : 400 }
      },
      "connect" : [
        { "id" : "f12", "to" : "f10" }
      ]
    }, {
      "id" : "f10",
      "type" : "CallSubEnd",
      "visual" : {
        "at" : { "x" : 528, "y" : 400 }
      }
    }, {
      "id" : "f13",
      "type" : "CallSubStart",
      "name" : "casualAnswer(String)",
      "config" : {
        "signature" : "casualAnswer",
        "input" : {
          "params" : [
            { "name" : "query", "type" : "String", "desc" : "The informal or off-topic user message" }
          ],
          "map" : {
            "out.query" : "param.query"
          }
        },
        "result" : {
          "params" : [
            { "name" : "casualResponse", "type" : "String", "desc" : "A polite response for informal or off-topic messages" }
          ],
          "map" : {
            "result.casualResponse" : "in.retrievedPolicies"
          }
        }
      },
      "tags" : [
        "tool"
      ],
      "visual" : {
        "at" : { "x" : 96, "y" : 512 },
        "description" : "Use this tool when the user's message is informal, casual, or not related to Axon Ivy or company policies, such as greetings, jokes, or off-topic questions"
      },
      "connect" : [
        { "id" : "f16", "to" : "f14" }
      ]
    }, {
      "id" : "f14",
      "type" : "Script",
      "name" : "build casual response",
      "config" : {
        "output" : {
          "code" : "in.retrievedPolicies = \"I appreciate your message! However, I'm the Axon Ivy AI Assistant, and I'm best suited to help with company policies and Axon Ivy-related questions. Feel free to ask me about benefits, leave policies, HR rules, or anything related to our workplace. How can I help you today?\";"
        }
      },
      "visual" : {
        "at" : { "x" : 304, "y" : 512 }
      },
      "connect" : [
        { "id" : "f17", "to" : "f15" }
      ]
    }, {
      "id" : "f15",
      "type" : "CallSubEnd",
      "visual" : {
        "at" : { "x" : 528, "y" : 512 }
      }
    } ],
  "layout" : {
    "lanes" : [ {
        "name" : "Tools of Chat Agent",
        "offset" : 320,
        "size" : 312
      } ]
  }
}